<!doctype html>
<html lang="en-us">
  <head>
    <title>centos 6.x 安装使用 docker // {GFO}</title>
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.55.6" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="SHUAI.W" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="https://ousui.org/css/main.min.03114f8f09611d603e9c8620893f2e0286ba0bdcaff1dc9b9a225f06888f01bc.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="centos 6.x 安装使用 docker"/>
<meta name="twitter:description" content="最近给公司系统搞 docker 部署，方便同事们外出部署项目，因为合作方的服务器都统一要求安装 centos，但是按照往年的经验，可能有些版本的 centos 没有升级，仍然停留在 6.x 时代。
根据 docker 官方的要求，linux 系统内核需要在 3.10 以上才可以有效运行，且内核版本越新越好： &gt; A 64-bit installation
&gt; Version 3.10 or higher of the Linux kernel. The latest version of the kernel available for you platform is recommended.
&gt; iptables version 1.4 or higher
&gt; git version 1.7 or higher
&gt; A ps executable, usually provided by procps or a similar package.
&gt; XZ Utils 4.9 or higher"/>

    <meta property="og:title" content="centos 6.x 安装使用 docker" />
<meta property="og:description" content="最近给公司系统搞 docker 部署，方便同事们外出部署项目，因为合作方的服务器都统一要求安装 centos，但是按照往年的经验，可能有些版本的 centos 没有升级，仍然停留在 6.x 时代。
根据 docker 官方的要求，linux 系统内核需要在 3.10 以上才可以有效运行，且内核版本越新越好： &gt; A 64-bit installation
&gt; Version 3.10 or higher of the Linux kernel. The latest version of the kernel available for you platform is recommended.
&gt; iptables version 1.4 or higher
&gt; git version 1.7 or higher
&gt; A ps executable, usually provided by procps or a similar package.
&gt; XZ Utils 4.9 or higher" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ousui.org/posts/centos-6-x-%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8-docker.html" />
<meta property="article:published_time" content="2017-02-16T08:54:21&#43;00:00"/>
<meta property="article:modified_time" content="2017-02-16T08:54:21&#43;00:00"/>


  </head>
  <body>
    <header class="app-header">
      <a href="https://ousui.org"><img class="app-header-avatar" src="https://avatars0.githubusercontent.com/u/2839512?s=460&amp;v=4" alt="SHUAI.W" /></a>
      <h1>{GFO}</h1>
      <p>GFO: github.io for ousui. 记录一些该记录的和不该记录的东西。</p>
      <div class="app-header-social">
        
          <a target="_blank" href="https://github.com/ousui"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg></a>
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">centos 6.x 安装使用 docker</h1>
      <div class="post-meta">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Feb 16, 2017
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          2 min read
        </div><div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <title>tag</title>
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line>
</svg>
          <a class="tag" href="https://ousui.org/tags/docker.html">docker</a><a class="tag" href="https://ousui.org/tags/linux.html">linux</a><a class="tag" href="https://ousui.org/tags/centos6.x.html">centos6.x</a></div></div>
    </header>
    <div class="post-content">
      

<p>最近给公司系统搞 docker 部署，方便同事们外出部署项目，因为合作方的服务器都统一要求安装 centos，但是按照往年的经验，可能有些版本的 centos 没有升级，仍然停留在 6.x 时代。<br />
根据 docker 官方的要求，linux 系统内核需要在 3.10 以上才可以有效运行，且内核版本越新越好：
&gt; A 64-bit installation<br />
&gt; Version 3.10 or higher of the Linux kernel. The latest version of the kernel available for you platform is recommended.<br />
&gt; iptables version 1.4 or higher<br />
&gt; git version 1.7 or higher<br />
&gt; A <code>ps</code> executable, usually provided by <code>procps</code> or a similar package.<br />
&gt; XZ Utils 4.9 or higher<br />
&gt; a properly mounted cgroupfs hierarchy; a single, all-encompassing cgroup mount point is not sufficient. See Github issues <a href="https://github.com/docker/docker/issues/2683">#2683</a>, <a href="https://github.com/docker/docker/issues/3485">#3485</a>, <a href="https://github.com/docker/docker/issues/4568">#4568</a>).</p>

<h2 id="升级内核">升级内核</h2>

<p>明显 centos6.x 2.xx 的内核版本已经不满足需求，那就需要先升级内核，才可以正常使用。</p>

<ol>
<li><p>升级内核，需要用到 elrepo 的 yum 源，首先导入 key</p>

<pre><code>rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org
</code></pre></li>

<li><p>然后安装软件源</p>

<pre><code> # RHEL-7, SL-7 or CentOS-7  
 sudo rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-2.el7.elrepo.noarch.rpm

 # RHEL-6, SL-6 or CentOS-6  
 sudo rpm -Uvh http://www.elrepo.org/elrepo-release-6-6.el6.elrepo.noarch.rpm

 # RHEL-5, SL-5 or CentOS-5  
 sudo rpm -Uvh http://www.elrepo.org/elrepo-release-5-5.el5.elrepo.noarch.rpm
</code></pre></li>

<li><p>最后安装新版内核，由于 elrepo-kernel 软件源没有启用，故而需要在安装的时候启用一下</p>

<pre><code># 安装 main line（主线）的内核，保持最新，安装 docker 推荐使用这个内核
sudo yum --enablerepo=elrepo-kernel install kernel-ml

# 安装 long time（长期支持）的内核，**不推荐**，docker 一些新特性可能无法使用
sudo yum --enablerepo=elrepo-kernel install kernel-lt
</code></pre></li>

<li><p>更改启动顺序</p>

<pre><code># centos7.x
sudo grub2-set-default 0

# centos6.x 需要修改下面的文件 default=0
sudo vi /etc/grub.conf
</code></pre></li>

<li><p>重启后，查看内核版本</p>

<pre><code>$ uname -r
</code></pre></li>
</ol>

<hr />

<h2 id="进行安装">进行安装</h2>

<h3 id="centos-7-x">centos 7.x</h3>

<p>直接添加官方源进行安装即可</p>

<ol>
<li><p>添加源，可以将源地址修改为 <code>https://mirrors.ustc.edu.cn/docker-yum/repo/centos7/</code> 进行加速</p>

<pre><code>sudo yum install -y yum-utils &amp;&amp;
sudo yum-config-manager \
  --add-repo \
  https://download.docker.com/linux/centos/docker-ce.repo
</code></pre></li>

<li><p>安装</p>

<pre><code>sudo yum makecache fast &amp;&amp;
sudo yum -y install docker-engine
</code></pre></li>
</ol>

<h3 id="centos-6-x">centos 6.x</h3>

<p>比较麻烦，需要下载源码包：
<a href="https://github.com/docker/docker/releases">Github 下载最新版</a></p>

<ol>
<li><p>解压</p>

<pre><code>tar xzvf /path/to/&lt;FILE&gt;.tar.gz
</code></pre></li>

<li><p><strong>可选</strong> 复制到 /usr/bin 目录</p>

<pre><code>sudo cp docker/docker* /usr/local/bin
</code></pre></li>

<li><p>执行启动</p>

<pre><code>sudo dockerd &amp;
</code></pre></li>
</ol>

<p>** 有时候执行不成功，需要先挂载 cgroupfs:</p>

<pre><code>wget https://raw.githubusercontent.com/tianon/cgroupfs-mount/master/cgroupfs-mount
</code></pre>

<p>** 可以不用那么复杂手动挂载 cgroup，可以下载 <a href="https://raw.githubusercontent.com/dotcloud/docker/master/contrib/init/sysvinit-redhat/docker">docker.service</a> 文件作为启动服务脚本</p>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
